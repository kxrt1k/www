---
import type { GetStaticPaths } from "astro";
import { getCollection } from "astro:content";

import Layout from "@/layouts/layout.astro";
import Container from "@/components/container.astro";
import Hero from "@/components/hero.astro";
import List from "@/components/list.astro";
import Footer from "@/components/footer.astro";

export const getStaticPaths = (async ({ paginate }) => {
  const posts = await getCollection("blog");
  const sortedPosts = posts.sort(
    (a, b) => b.data.date.getTime() - a.data.date.getTime()
  );
  const normalizedPosts = sortedPosts.map((post) => ({
    date: post.data.date.toISOString(),
    title: post.data.title,
    id: post.id,
  }));

  return paginate(normalizedPosts, { pageSize: 2 });
}) satisfies GetStaticPaths;

const { page } = Astro.props;
---

<Layout>
  <Container>
    <Hero
      title={page.currentPage === 1 ? "Blog Posts" : `Page ${page.currentPage}`}
      description="Collection of blog posts."
      backLabel={page.currentPage === 1 ? "Home" : "Back"}
      backUrl={page.currentPage === 1
        ? "/"
        : page.currentPage - 1 === 1
          ? "/blog"
          : `/blog/${page.currentPage - 1}`}
    />
    <List
      items={page.data.map((page) => ({
        title: page.title,
        url: `/blog/${page.id}`,
        date: page.date,
      }))}
    />
    <Footer />
    <Container />
  </Container></Layout
>
